{% extends 'base.html' %} {% block content %}

<!--  -->
<div class="row mb-3">
  <div class="col">
    <button
      class="btn btn-success"
      data-bs-toggle="modal"
      data-bs-target="#addPaymentSupplierModal"
    >
      + Paiements Fournisseur
    </button>
  </div>
  <div class="col ms-1">
    <button
      class="btn btn-success"
      data-bs-toggle="modal"
      data-bs-target="#addPaymentCostModal"
    >
      + Paiements Charge
    </button>
  </div>
</div>
<div class="row mb-3">
  <div class="col mb-3">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title">Paiements Fournisseurs</h5>
      </div>

      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th scope="col">Nom</th>
                <th scope="col">Mode de Payment</th>
                <th scope="col">Montant</th>
                <th scope="col">Ajouté le</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              {% for payment in payments | rejectattr('company_id', "none") %}
              <tr>
                <td>{{payment.company.name}}</td>
                <td>
                  {{payment.paymentmethod.name}}
                  <!--  -->
                  {% if payment.paymentmethod_id in [2,3] %}
                  <br />
                  <small style="font-size: 10px"
                    >Nummero: <b> {{payment.document_number | upper}}</b>
                  </small>
                  ,
                  <small class="text-end" style="font-size: 10px"
                    >Échéance le: <b> {{payment.due_date}}</b>
                  </small>
                  ,
                  <!--  -->
                  {% if payment.document_filename != "" %}

                  <a href="/uploads/{{payment.document_filename}}" target="_blank"
                    <i class="bi bi-file-earmark-arrow-down"></i
                  ></a>
                  {% endif %}
                  <!--  -->

                  {% endif %}
                </td>
                <td>{{payment.amount}} <small>TND</small></td>
                <td>{{payment.date}}</td>
                <td>
                  <div class="dropdown me-2">
                    <a
                      class="btn btn-link dropdown float-end text-decoration-none"
                      type="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      ...
                    </a>

                    <ul
                      class="dropdown-menu dropdown-menu-end"
                      aria-labelledby="dropdownMenuButton2"
                    >
                      <li><a class="dropdown-item" href="#">Afficher</a></li>
                      <li>
                        <a class="dropdown-item" href="#">My Companie 2</a>
                      </li>
                      <li><hr class="dropdown-divider" /></li>
                      <li>
                        <a class="dropdown-item" href="#"
                          >Ajouter une société</a
                        >
                      </li>
                    </ul>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col mb-3">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title">Paiements Charges</h5>
      </div>

      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th scope="col">Nom</th>
                <th scope="col">Mode de Payment</th>
                <th scope="col">Montant</th>
                <th scope="col">Ajouté le</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              {% for payment in payments | rejectattr('cost_id', "none") %}
              <tr>
                <td>{{payment.costsdef.name}}</td>
                <td>
                  {{payment.paymentmethod.name}}
                  <!--  -->
                  {% if payment.paymentmethod_id in [2,3] %}
                  <br />
                  <small style="font-size: 10px"
                    >Nummero: <b> {{payment.document_number | upper}}</b>
                  </small>
                  ,
                  <small class="text-end" style="font-size: 10px"
                    >Échéance le: <b> {{payment.due_date}}</b>
                  </small>

                   ,
                  <!--  -->
                  {% if payment.document_filename != "" %}

                  <a href="/uploads/{{payment.document_filename}}" target="_blank">
                    <i class="bi bi-file-earmark-arrow-down"></i
                  ></a>
                  {% endif %}
                  <!--  -->

                  {% endif %}
                </td>
                <td>{{payment.amount}} <small>TND</small></td>
                <td>{{payment.date}}</td>
                <td>
                  <div class="dropdown me-2">
                    <a
                      class="btn btn-link dropdown float-end text-decoration-none"
                      type="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      ...
                    </a>

                    <ul
                      class="dropdown-menu dropdown-menu-end"
                      aria-labelledby="dropdownMenuButton2"
                    >
                      <li><a class="dropdown-item" href="#">Afficher</a></li>
                      <li>
                        <a class="dropdown-item" href="#">My Companie 2</a>
                      </li>
                      <li><hr class="dropdown-divider" /></li>
                      <li>
                        <a class="dropdown-item" href="#"
                          >Ajouter une société</a
                        >
                      </li>
                    </ul>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="addPaymentSupplierModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form action="/payments" method="post"  enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">
            Ajouter un nouveau Paiement Fournisseur
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <div class="row">
              <div class="col-6">
                <label for="recipient-name" class="col-form-label"
                  >Fournisseurs:</label
                >
                <select
                  name="company_id"
                  class="form-select form-select-sm"
                  aria-label="Default select example"
                >
                  {% for supplier in suppliers %}
                  <option value="{{supplier.id}}">{{supplier.name}}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-6">
                <label for="recipient-name" class="col-form-label"
                  >Mode de payment:</label
                >
                <select
                  name="payment_id"
                  id="payment_id"
                  class="form-select form-select-sm"
                  aria-label="Default select example"
                  onchange="ChangePaymentmethod(this)"
                >
                  {% for payment in paymentmethod %}
                  <option value="{{payment.id}}">{{payment.name}}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col-6">
                <label for="recipient-name" class="col-form-label">Date:</label>
                <div class="input-group mb-3">
                  <input
                    name="date"
                    type="date"
                    class="form-control form-control-sm"
                    id="date"
                    max="{{today()}}"
                    value="{{today()}}"
                    required
                  />
                </div>
              </div>
              <div class="col-6">
                <label for="amount" class="col-form-label">Montant:</label>
                <div class="input-group input-group-sm mb-3">
                  <input
                    name="amount"
                    type="number"
                    min="0"
                    class="form-control border-primary"
                    id="amount"
                    required
                  />
                  <span class="input-group-text">TND</span>
                </div>
              </div>
            </div>

            <!-- document -->
            {% include 'document.html' %}
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Message:</label>
            <textarea
              name="comment"
              class="form-control"
              id="message-text"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Fermer
          </button>
          <button type="submit" class="btn btn-primary">Sauvegarder</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="addPaymentCostModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form action="/payments" method="post" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">
            Ajouter un nouveau Paiement Charge
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <div class="row">
              <div class="col-6">
                <label for="recipient-name" class="col-form-label"
                  >Charge:</label
                >
                <select
                  name="cost_id"
                  class="form-select form-select-sm"
                  aria-label="Default select example"
                >
                  {% for cost_def in cost_defs %}
                  <option value="{{cost_def.id}}">{{cost_def.name}}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-6">
                <label for="recipient-name" class="col-form-label"
                  >Mode de payment:</label
                >
                <select
                  name="payment_id"
                  id="payment_id1"
                  class="form-select form-select-sm"
                  aria-label="Default select example"
                  onchange="ChangePaymentmethod1()"
                >
                  {% for payment in paymentmethod %}
                  <option value="{{payment.id}}">{{payment.name}}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col-6">
                <label for="recipient-name" class="col-form-label">Date:</label>
                <div class="input-group mb-3">
                  <input
                    name="date"
                    type="date"
                    class="form-control form-control-sm"
                    id="date"
                    max="{{today()}}"
                    value="{{today()}}"
                    required
                  />
                </div>
              </div>
              <div class="col-6">
                <label for="amount" class="col-form-label">Montant:</label>
                <div class="input-group input-group-sm mb-3">
                  <input
                    name="amount"
                    type="number"
                    min="0"
                    class="form-control border-primary"
                    id="amount1"
                    required
                  />
                  <span class="input-group-text">TND</span>
                </div>
              </div>
            </div>

            <!-- document1 -->
            <div id="document1">
              <div class="card">
                <div class="card-header bg-warning">Cheque/Traite</div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-6">
                      <label for="recipient-name" class="col-form-label"
                        >Nummero:</label
                      >
                      <div class="input-group mb-3">
                        <input
                          name="document_number"
                          type="text"
                          class="form-control form-control-sm border-primary"
                          id="document_number1"
                          required
                          value=""
                          onkeypress="return onlyNumberKey1(event)"
                        />
                      </div>
                      <div
                        class="alert alert-danger visually-hidden mt-1"
                        id="alert1"
                        role="alert"
                      >
                        <small>Veuillez saisir uniquement des chiffres</small>
                      </div>
                    </div>
                    <div class="col-6">
                      <label for="recipient-name" class="col-form-label"
                        >Date d'échéance:</label
                      >
                      <div class="input-group mb-3">
                        <input
                          name="due_date"
                          type="date"
                          class="form-control form-control-sm border-primary"
                          id="due_date1"
                          min="{{today()}}"
                          required
                        />
                      </div>
                    </div>
                    <label for="recipient-name" class="col-form-label"
                      >Document:</label
                    >
                    <div class="input-group mb-3">
                      <input
                        name="foto"
                        type="file"
                        class="form-control form-control-sm"
                        id="foto"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Message:</label>
            <textarea
              name="comment"
              class="form-control"
              id="message-text"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Fermer
          </button>
          <button type="submit" class="btn btn-primary">Sauvegarder</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}
